/***************************************
* @license
* ForeSee Client Code: Feedback
* http://www.answers.com/page/businesssolutions
* Built March 30, 16 10:01:32
* Version: 1.0.11
***************************************/
("undefined"!=typeof _acsDefine?_acsDefine:define)(["require","_acs","feedbackconfig",_acsNormalizeUrl("feedback/fs.utils.js")],function(e,t,config,i){function s(e,t,s,n){if(d[e])return d[e].success.subscribe(t||function(){},!0,!0),void d[e].fail.subscribe(s||function(){},!0,!0);var o,r,a,c=!1;this.count=this.count?++this.count:1,o=this.count,r="load-css-"+o,a=document.createElement("link"),a.setAttribute("id",r),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css");var h={link:a,url:e,didfail:!1,didsucceed:!1,success:new i.FSEvent,fail:new i.FSEvent};return h.success.subscribe(t,!0,!0),h.fail.subscribe(s,!0,!0),d[e]=h,"undefined"!=typeof a.addEventListener?"Android"==n.os.name&&n.os.version<4.4?setTimeout(function(){c=!0,h.didsucceed=!0,h.success.fire(a)},250):(a.addEventListener("load",function(){c=!0,h.didsucceed=!0,h.success.fire(a)},!1),a.addEventListener("error",function(){h.didfail=!0,h.fail.fire(a)},!1)):"undefined"!=typeof a.attachEvent&&a.attachEvent("onload",function(){var e,t,i=document.styleSheets.length;try{for(;i--;)if(t=document.styleSheets[i],t.id===r)return e=t.cssText,c=!0,h.didsucceed=!0,void h.success.fire(a)}catch(s){}c||(h.didfail=!0,h.fail.fire(a))}),document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("href",e),a}var n=window.location.href.toString().toLowerCase();if(!(n.indexOf("argos.co")>-1&&window!==window.top)){t.home.indexOf("/serve/")>-1&&(ACS_OVERRIDES={FBALTSCROLL:!0});var o={remove:function(){this.parentNode&&this.parentNode.removeChild(this)},hasClass:function(e){return this.className.indexOf(e)>-1},addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,"")},$:function(e){return this.querySelectorAll(e)},css:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.style[t]=e[t])}},r=function(e){if("string"==typeof e&&-1==e.indexOf("<"))return document.querySelectorAll(e);if("string"==typeof e){var t=document.createElement("div");t.innerHTML=e,e=t.firstChild}for(var i in o)o.hasOwnProperty(i)&&(e[i]=o[i]);return e},a="Func",c="ion",h=function(e,t){var i;return(i=new window[a+"t"+c]("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"))(t||{})},d={},l=function(e,s,n,o,r,a){this.cfg=e,this.cpps=n;var c="acsFeedbackResultsCounter";this.gotbadge=!1,this.btncfg=e,this.badgeClicked=new i.FSEvent,this.surveyTriggered=new i.FSEvent,this.br=s,this.animationMove=4,this.btncfg.imgsrc=t.makeURI("/feedback/templates/"+e.template+"/"+e.icon),e.counter?(this.isIcon=!1,this.counter=0,sessionStorage.getItem(c)&&(this.counter=Math.round(parseFloat(sessionStorage.getItem(c))),this.counter=isNaN(this.counter)?0:this.counter),this.btncfg.counter=this.counter,this.btncfg.counterLocale=e.counter.toLocaleString()):this.isIcon=!0,this.btncfg.btnClass="_acs _acs"+e.fbtype+"--"+e.template+" _acs"+e.fblocation,this.btnTemplate=o,this.emtemplate=r,this.enabled=!!a};l.prototype.setBtnTemplate=function(){var e={btncfg:this.btncfg},t=h(this.btnTemplate,e),s=this;s.badgeClicked.subscribe(function(){s.br.isMobile||u("feedback_clicked",{mid:s.cfg.mid}),s.surveyTriggered.fire({emtemplate:s.emtemplate})},!1,!0),this.$el=document.createElement("div"),this.$el.innerHTML=t,this.$el=r(this.$el.querySelectorAll("div._acs")[0]),this.enabled&&i.Bind(this.$el,"feedback:click",function(){s._unhover(),s.badgeClicked.fire(s.cfg)}),this.cfg.fbanimate&&(i.Bind(this.$el,"feedback:mouseenter",function(){s._hover()}),i.Bind(this.$el,"feedback:mouseleave",function(){s._unhover()})),document.body.appendChild(this.$el),i.addClass(document.documentElement,"fsfb fsfb-relbody"),this.cfg.delay&&this.cfg.delay>0?setTimeout(i.proxy(function(){this.init()},this),this.cfg.delay):this.init()},l.prototype._hover=function(){this.cfg.fbanimate&&this.$el.addClass("_acsHover")},l.prototype._unhover=function(){this.cfg.fbanimate&&this.$el.removeClass("_acsHover")},l.prototype.init=function(e){var t=this.$el.$("._acsBadgeLabel"),i=this,s=i.cfg;if(e=e||function(){},this.$el.css({visibility:"hidden"}),t&&t.length>0){if(e){if(i._unhover(),this.isIcon)g("templates/"+s.template+"/"+s.icon,function(t){return function(s,n){setTimeout(function(){i._unhover(),setTimeout(function(){t.addClass("_acsAnimate"),e()},50),i._unhover()},50)}}(this.$el));else{i._unhover();var n=this.$el;setTimeout(function(){i._unhover(),setTimeout(function(){n.addClass("_acsAnimate"),e()},250)},250)}"vertical"==this.cfg.fbdirection&&(this.cfg.fblocation.indexOf("right")>-1?this.$el.addClass("_acsVertical_right"):this.$el.addClass("_acsVertical_left")),this.cfg.fbfixed&&this.$el.addClass("_acsFixed")}"none"===this.cfg.fbtype?this.$el.css({display:"none"}):this.$el.css({visibility:"visible"})}},l.prototype.setCounter=function(e){this.numTween&&(this.numTween.stop(),this.counter=this.numTween.val);var t=this.$el.$("._acsCounterInner")[0];this.numTween=new b(this.counter,e,i.proxy(function(e){t.innerHTML=Math.round(e).toLocaleString()},this)),this.numTween.go(1e3),sessionStorage.setItem("acsFeedbackResultsCounter",e)},l.prototype.disableCounter=function(){var e=this.$el.$("._acsBadgeImg")[0],i=this.cfg;e||(this.$el.$("._acsCounterInner")[0].innerHTML="",r(this.$el.$("._acsCounterInner")[0]).css({background:"none"}),e=r('<img style="position: relative;top: -2px;height: 19px;" src="'+t.makeURI("/feedback/templates/"+i.template+"/"+i.icon)+'" class="_acsBadgeImg">'),this.$el.$("._acsCounterInner")[0].appendChild(e))},l.prototype.enableCounter=function(){var e=this.$el.$("._acsBadgeImg")[0];e&&(this.$el.$("._acsCounterInner")[0].innerHTML="0",r(this.$el.$("._acsCounterInner")[0]).css({background:"#F87473"}))},l.prototype.remove=function(){this.enabled=!1,this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)};var u=function(e,t,s,n){t=i.ext({pid:"qw0efhha4z",e:e},t||{}),t.code_version=config.code_version;var o=new i.ImageTransport;o.send({url:"https://www.dsply.com/index.php",success:s||function(){},failure:n||function(){},data:t})},p={exposePublicAPI:function(e,t,s){var n={},o=e.FSR||{},r=o.CPPS;if(n.CPPS=r||t,r){var a=r.set;r.set=function(e,i){t.set(e,i),a&&a.call(r,e,i)}}n.launchACSFeedback=function(e){for(var n,o=!1,r=!1,a=config.instances,c=0;c<a.length;c++)if(a[c].mid==e){n=c,o=a[c];break}if(o&&o.disabled)return"This feedback has been disabled.";if(o.topics&&o.topics.length)for(var h=0;h<o.topics.length;h++)if(m(o.topics[h])){r=!0;break}if(!o)return"Error: MID provided is not valid";if(!r&&0!==o.topic.length)return"Error: Either this measure is disabled or there are no active topics";if((r||0===inst.topics.length)&&!o.disabled){o.surveytype||"undefined"==typeof o.popup||(o.surveytype=o.popup?"popup":"modal"),o.template||(o.template="default");var d={},l=function(e,t,s,n){var o=window.location.pathname,r=o.substr(0,o.indexOf("feedback")),a=i.makeURI(r+"feedback/templates/"+e+"/"+t+".html"),c=new i.JSONP({success:i.proxy(function(e){n(e),s&&s.resolve()},this),failure:i.proxy(function(e){s&&s.error()},this)});c.get(a,"_templates_"+(e||"default")+"_")},u=new i.Async(!0,i.proxy(function(){var e=x.initialize(o,s,t,d.emTemplate,d.svContentsTemplate,d.epTemplate);e.show()},this),i.proxy(function(){},this));u.enqueue(function(e){l(o.template,"epilogue",e,function(e){d.epTemplate=e})}),u.enqueue(function(e){l(o.template,"surveycontents",e,function(e){d.svContentsTemplate=e})}),u.enqueue(function(e){l(o.template,"serviceunavailable",e,function(e){d.emTemplate=e})})}},e.FSFB||(e.FSFB={}),i.ext(e.FSFB,n,!1)}},f=function(){var e=r('<img src="'+t.makeURI("/feedback/loader.gif")+'" class="acs-loader">');this.$el=e};f.prototype.center=function(e){var t=this.$el.parentNode.offsetWidth,i=(this.$el.parentNode.offsetHeight,this.$el.offsetWidth);this.$el.offsetHeight;this.$el.css({left:(t-i)/2+"px",top:e?(t-i)/2+"px":"auto"})},f.prototype.remove=function(){this.$el.parentNode.removeChild(this.$el)};var v=function(e,t,i){this.template=i,this.br=e,this.cpps=t,this.emTemplate=null,this.css=null,this.typeTemplate=null,this.svContentsTemplate=null,this.epTemplate=null};v.prototype.getCss=function(e){s(t.makeURI("/feedback/templates/"+(this.template||"default")+"/fs.feedback.css"),function(t){t?e&&e.resolve():e&&e.error()},null,this.br)},v.prototype.getTemplate=function(e,s,n){var o=t.makeURI("/feedback/templates/"+(this.template||"default")+"/"+e+".html"),r="_templates_"+(this.template||"default")+"_",a=new i.JSONP({success:i.proxy(function(e){n&&n(e),s&&s.resolve()},this),failure:i.proxy(function(e){s&&s.error()},this)});a.get(o,r)},v.prototype.grabTemplates=function(e){this.queue=new i.Async(!0,i.proxy(function(){e&&e({typeTemplate:this.typeTemplate,emTemplate:this.emTemplate,epTemplate:this.epTemplate,svContentsTemplate:this.svContentsTemplate})},this),i.proxy(function(){},this)),this.queue.enqueue(i.proxy(function(e){this.getCss(e)},this)),this.queue.enqueue(i.proxy(function(e){this.getTemplate("badge",e,i.proxy(function(e){this.typeTemplate=e},this))},this)),this.queue.enqueue(i.proxy(function(e){this.getTemplate("serviceunavailable",e,i.proxy(function(e){this.emTemplate=e},this))},this)),this.queue.enqueue(i.proxy(function(e){this.getTemplate("epilogue",e,i.proxy(function(e){this.epTemplate=e},this))},this)),this.queue.enqueue(i.proxy(function(e){this.getTemplate("surveycontents",e,i.proxy(function(e){this.svContentsTemplate=e},this))},this))};var m=function(e){function t(e){for(n=0;n<e.length;n++){for(s=c,r=e[n].replace(/^\s+|\s+$/g,"").replace(/[\*]{2,}/g,"*").toLowerCase(),i=[];r.indexOf("*")>-1;)r.indexOf("*")>0&&i.push(r.substr(0,r.indexOf("*"))),i.push("*"),r=r.substr(r.indexOf("*")+1);for(r.length>0&&i.push(r),a=0===i.length?!1:!0,o=0;o<i.length;o++)if(r=i[o],"*"==r){if(i.length>o+1){if(o++,-1==s.indexOf(i[o])){a=!1;break}s=s.substr(s.indexOf(i[o])+i[o].length)}if(o==i.length-1&&"*"!==i[o]&&s!=i[o]&&s!=i[o]+"/"&&i[o]!=s+"/"&&s.length>0&&"/"!=s){a=!1;break}}else{if(s.substr(0,r.length)!=r&&s!=r+"/"&&r!=s+"/"){a=!1;break}if(s=s.substr(r.length),o==i.length-1&&s.length>0&&"/"!=s){a=!1;break}}if(a)return!0}return!1}var i,s,n,o,r,a,c=window._acsURL||window.location.toString().toLowerCase();return!e.whitelistActive||t(e.whitelistData)},b=function(e,t,i){this.from=e,this.to=t,this.diff=this.to-this.from,this.callback=i||function(){}};b.prototype={_tween:function(e){return--e*e*e+1},go:function(e){this.stop(),this.tm=e,this.startTime=new Date,this.timer=setInterval(i.proxy(function(){var e=new Date,t=e-this.startTime,i=Math.min(t/this.tm,1),s=this._tween(i);i>=1&&(clearInterval(this.timer),this.timer=null),this.val=s*this.diff+this.from,this.callback(this.val)},this),20)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}};var g=function(e,i){var s=function(){};i=i||s;var n=new Image;n.onload=function(){i(n.width,n.height)},n.onerror=function(){},e.indexOf("//")>-1?n.src=e:n.src=t.makeURI("/feedback/"+e),n.width&&(n.onload=n.onerror=s,i(n.width,n.height))},y=function(e){var t=window.location.hash.toString();if(t&&t.length>0)for(var i=t.split("&"),s=0;s<i.length;s++){var n=i[s].split("="),o=n[0].toLowerCase().trim();if(o==e.toLowerCase()){if(n.length>1)return decodeURIComponent(n[1]);break}}},w=function(e,t){this.br=e,this.cfg=t};w.prototype.platformOK=function(){var e=this.cfg,t=this.br;return e.browser_cutoff[t.browser.name]&&t.browser.actualVersion<e.browser_cutoff[t.browser.name]?!1:e.platform_cutoff[t.os.name]&&t.os.version<e.platform_cutoff[t.os.name]?!1:!0};var _=function(e,t,s){this.br=e,this.cpps=t,this.templateHolder={},this.loadSuccess=new i.FSEvent,this.loadFailure=new i.FSEvent;var n=new i.Async(!0,i.proxy(function(){this.loadSuccess.fire(this.templateHolder)},this),i.proxy(function(){this.loadFailure.fire()},this));n.enqueue(i.proxy(function(e){this.checkHealth(e)},this));for(var o=0;o<s.length;o++)n.enqueue(i.proxy(function(e){return function(t){var s=new v(this.br,this.cpps,e);s.grabTemplates(i.proxy(function(i){i?(this.templateHolder[e]=i,t.resolve()):t.error()},this))}}(s[o]),this))};_.prototype.checkHealth=function(e){setTimeout(i.proxy(function(){e.resolve()},this),1)};var k=function(e,t,s){var n,o=e.mid||i.getParam("mid"),a=t.isIE&&t.browser.version<9;if(this.br=t,this.queue=new i.Async(!0,i.proxy(function(){this.renderSurvey()},this),i.proxy(function(){},this)),this.cpps=s,e.preview)n=this.cfg=e;else for(var c=0;c<e.instances.length;c++)if(e.instances[c].mid==o){n=this.cfg=e.instances[c];break}if(n){document.title=this.cfg.label;var h=this.sv=new I(this.cfg,this.cpps,this.br),d=this;this.$content=r('<div class="acsMainContainerMobile--'+n.template+(a?" ie8":"")+'"></div>');var l=new v(this.br,this.cpps,this.cfg.template);this.queue.enqueue(i.proxy(function(e){l.getCss(e)},this)),this.queue.enqueue(i.proxy(function(e){l.getTemplate("surveycontents",e,i.proxy(function(e){this.template=e},this))},this)),this.queue.enqueue(i.proxy(function(e){l.getTemplate("epilogue",e,i.proxy(function(e){this.eptemplate=e},this))},this)),this.queue.enqueue(i.proxy(function(e){h._getSurveyData(function(t){d.survey=t,e.resolve()})},this))}};k.prototype._showThankyou=function(){var e=h(this.eptemplate,this.survey);this.$content.innerHTML=e;for(var t=this.$content.$("h1"),s=0;s<t.length;s++)r(t[s]).addClass("acs-feedback__heading acs-feedback__heading--h1");var n=this.$content.$(".acs-close-button")[0];i.Bind(n,"feedback:click",function(){window.close()}),window.location.hash="acsSurveyComplete"},k.prototype.renderSurvey=function(){var e=this;this.survey.ansLogoSrc="undefined"!=typeof t?t.makeURI("/feedback/p_b_answers.png"):"p_b_answers.png";var i=h(this.template,this.survey);this.$content.innerHTML=i,"fullpage"===this.cfg.surveytype?(this.$el=r('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.$closebtn=r('<span><img src="'+t.makeURI("/feedback/templates/"+(this.sv.cfg.template||"default")+"/closeBtn"+(this.IE8?"IE8":"")+".png")+'" class="acsModalCloseButton"></span>'),window.document.body.innerHTML="",this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content),window.document.body.appendChild(this.$el)):window.document.body.appendChild(this.$content),this.sv.bind(this.$content),this.$content.css({opacity:1}),this.sv.SurveySubmitted.subscribe(function(){e._showThankyou()})};var $=function(e){this.br=e,this.mid=y("mid"),this.previewmode=y("previewmode").toLowerCase(),this.datauri=y("datauri"),this.template=y("template")||"default",this.surveytype=y("surveytype")?y("surveytype"):"modal",this.tempHolder={}};$.prototype.show=function(){if(this.mid&&this.previewmode&&this.datauri)if("desktop"==this.previewmode){var e=new _(this.br,{},[this.template]);e.loadSuccess.subscribe(i.proxy(function(e){this.tempHolder=e[this.template];x.initialize({mid:this.mid,datauri:this.datauri,posturi:"",reporturi:"",surveytype:this.surveytype,autowhitelist:!0,preview:!0,template:this.template},this.br,null,this.tempHolder.emTemplate,this.tempHolder.svContentsTemplate,this.tempHolder.epTemplate)},this)),e.loadFailure.subscribe(i.proxy(function(){},this))}else switch(this.previewmode){case"tablet":new k({mid:this.mid,datauri:this.datauri,posturi:"",reporturi:"",surveytype:this.surveytype,autowhitelist:!0,preview:!0,template:this.template},this.br);break;case"phone":new k({mid:this.mid,datauri:this.datauri,posturi:"",reporturi:"",surveytype:this.surveytype,autowhitelist:!0,preview:!0,template:this.template},this.br)}else alert("You need mid, previewmode, and datauri.")};var S=function(e,s,n,o,a,c){this.sv=e,this.br=s,this.cpps=n,this.errTemplate=o,this.svTemplate=a,this.epTemplate=c,this.$domContent=[],this.$btns=[];for(var d=d||window,l=d.document.body.childNodes,p=0;p<l.length;p++)1===l[p].nodeType&&r(l[p]).hasClass("_acs")?this.$btns.push(l[p]):this.$domContent.push(l[p]);this.$el=r('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.SurveySubmitted=new i.FSEvent,this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.sv._getSurveyData(i.proxy(function(e){this.survey=e,this.survey.meta.privacyurl=this.sv.cfg.privacyuri,this.survey.meta.privacytext=this.sv.cfg.privacytext,this.show()},this)),e.SurveySubmitStarted.subscribe(i.proxy(function(){this.$content.removeClass("acsVisible"),this._showWait()},this)),e.networkError.subscribe(i.proxy(function(s){this._removeWait(),s&&s.type?u("survey_"+s.type,{mid:e.cfg.mid}):u("server_error",{mid:e.cfg.mid}),this.$content=r('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el=r('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.$closebtn=r('<span><img src="'+t.makeURI("/feedback/templates/"+(this.sv.cfg.template||"default")+"/closeBtn"+(this.IE8?"IE8":"")+".png")+'" class="acsModalCloseButton"></span>'),this.$content.innerHTML=h(this.errTemplate,this.survey),i.Bind(this.$closebtn,"feedback:click",i.proxy(function(){this.hide(!0)},this)),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);var n=this.$el.$(".acs-close-button")[0];i.Bind(n,"feedback:click",i.proxy(function(){this.hide(!0)},this)),this.$content.addClass("acsVisible"),window.document.body.innerHTML="",window.document.body.appendChild(this.$el)},this)),e.SurveySubmitted.subscribe(i.proxy(function(){u("feedback_submitted",{mid:e.cfg.mid}),this.$content.addClass("acsVisible"),this._showThankyou(),this.SurveySubmitted.fire(),this._removeWait()},this))};S.prototype._renderSurvey=function(){var e=e||window,s=this.sv.cfg,n=this,o=e.document.body;if(!this.sv.cfg.preview){var a=function(e){27==e.keyCode&&(u("feedback_abandoned",{mid:s.mid}),n.hide(!1)),i.Unbind(document.body,"feedback:keyup",a)};i.Bind(document.body,"feedback:keyup",a)}"undefined"!=typeof ACS_OVERRIDES&&ACS_OVERRIDES.FBALTCONTAINER&&(o=document.querySelector(ACS_OVERRIDES.FBALTCONTAINER)||e.document.body),"undefined"!=typeof ACS_OVERRIDES&&ACS_OVERRIDES.FBALTSCROLL&&(o+="_acsAltScroll"),o.innerHTML="",0===this.$el.children.length&&(this.$closebtn=r('<span><img src="'+t.makeURI("/feedback/templates/"+(this.sv.cfg.template||"default")+"/closeBtn"+(this.IE8?"IE8":"")+".png")+'" class="acsModalCloseButton"></span>'),this.$content=r('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content)),o.appendChild(this.$el),this.sv.cfg.preview||i.Bind(this.$closebtn,"feedback:click",i.proxy(function(){u("feedback_abandoned",{mid:s.mid}),this.hide(!1)},this)),u("survey_shown",{mid:this.sv.cfg.mid}),this._showWait()},S.prototype._showWait=function(){this._removeWait(),this._wait=new f,this.$el.appendChild(this._wait.$el),this._wait.center();var e=i.getScroll(window),t=i.getSize(window);this._wait.$el.css({position:"absolute",top:e.y+(t.h-this._wait.$el.offsetHeight)/2+"px",left:e.x+(t.w-this._wait.$el.offsetWidth)/2+"px"})},S.prototype._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},S.prototype.hide=function(e){window.document.body.innerHTML="";for(var t=0;t<this.$domContent.length;t++)window.document.body.appendChild(this.$domContent[t]);e||this._showBtns()},S.prototype._showBtns=function(){for(var e=0;e<this.$btns.length;e++)window.document.body.appendChild(this.$btns[e])},S.prototype.show=function(){if(this._renderSurvey(),this._removeWait(),this.survey.ansLogoSrc=t.makeURI("/feedback/p_b_answers.png"),0===this.$content.children.length){var e=h(this.svTemplate,this.survey);this.$content.innerHTML=e,this.sv.bind(this.$content)}this.$content.addClass("acsVisible"),this.sv.SurveyUIUpdated.fire()},S.prototype._showThankyou=function(){this._removeWait();var e=h(this.epTemplate,this.survey);this.$closebtn=r('<span><img src="'+t.makeURI("/feedback/templates/"+(this.sv.cfg.template||"default")+"/closeBtn"+(this.IE8?"IE8":"")+".png")+'" class="acsModalCloseButton"></span>'),this.sv.cfg.preview||i.Bind(this.$closebtn,"feedback:click",i.proxy(function(){this.hide(!0)},this),!0),this.$content.innerHTML=e,this.$el.removeChild(this.$el.childNodes[0]),this.$el.removeChild(this.$el.childNodes[0]),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);for(var s=this.$el.$(".acs-close-button")[0],n=this.$el.$("h1"),o=0;o<n.length;o++)r(n[o]).addClass("acs-feedback__heading acs-feedback__heading--h1");this.sv.cfg.preview||i.Bind(s,"feedback:click",i.proxy(function(){this.hide(!0)},this))};var C=function(e,t,i){this.cfg=e,this.br=t,this.cpps=i;t.isIE&&t.browser.version<9};C.prototype.renderBadge=function(){var e=new _(this.br,this.cpps,[this.cfg.template]);e.loadSuccess.subscribe(i.proxy(function(e){var t=e[this.cfg.template];this.cfg.badge=new l(this.cfg,this.br,this.cpps,t.typeTemplate,t.emTemplate,!1),this.cfg.badge.setBtnTemplate()},this)),e.loadFailure.subscribe(i.proxy(function(){}))};var x={};x.popups=[],x.getPopup=function(e){var t=i.getSize(window);if(t.w<=500)return!1;var s=x.popups;if(s.length>0){for(var n=0;n<s.length;n++)if(s[n].cfg.mid==e)return s[n];return!1}return!1},x.removePopup=function(e){for(var t=x.popups,i=[],s=0;s<t.length;s++)t[s].cfg.mid!==e&&i.push(t);x.popups=i},x.initialize=function(e,t,i,s,n,o){e.surveytype||"undefined"==typeof e.popup||(e.surveytype=e.popup?"popup":"modal");var r=x.getPopup(e.mid);return r&&!r.cfg.popup?r.show():(r=new M(e,t,i,s,n,o),x.popups.push(r),r.SurveySubmitted.subscribe(function(){x.SurveySubmitted.fire()}),r.NetworkError.subscribe(function(){x.removePopup(e.mid),x.NetworkError.fire()})),r},x.SurveySubmitted=new i.FSEvent,x.NetworkError=new i.FSEvent;var T=function(e,t,s,n,o,a){this.sv=e,this.cfg=e.cfg,this.instcfg=s,this.browser=t,this.em=n,this.noserv=n,this.eptemplate=a,this.IE8=t.isIE&&t.browser.version<9,this.add(),this.modaltemplate=o;var c=this;this.SurveySubmitted=new i.FSEvent,this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",e._getSurveyData(function(e){c.survey=e,c.survey.meta.privacyurl=c.sv.cfg.privacyuri,c.survey.meta.privacytext=c.sv.cfg.privacytext,c.renderSurvey()}),e.SurveySubmitStarted.subscribe(function(){c.$content.removeClass("acsVisible"),c._showWait()}),e.networkError.subscribe(function(t){c._removeWait(),t&&t.type?u("survey_"+t.type,{mid:e.cfg.mid}):u("server_error",{mid:e.cfg.mid}),c.$content.innerHTML=h(c.noserv,c.survey);for(var s=c.$content.$("h1"),n=0;n<s.length;n++)r(s[n]).addClass("acs-feedback__heading acs-feedback__heading--h1");c.positionModal();var o=c.$content.$(".acs-close-button")[0];i.Bind(o,"feedback:click",function(){c.remove()}),c.$content.addClass("acsVisible")}),e.SurveySubmitted.subscribe(function(){u("feedback_submitted",{mid:e.cfg.mid}),c.$content.addClass("acsVisible"),c._showThankyou(),c.SurveySubmitted.fire(),c._removeWait()})};T.prototype._showThankyou=function(){var e=this,t=h(this.eptemplate,this.survey);this.$content.innerHTML=t;for(var s=this.$content.$("h1"),n=0;n<s.length;n++)r(s[n]).addClass("acs-feedback__heading acs-feedback__heading--h1");this.positionModal();var o=this.$content.$(".acs-close-button")[0];i.Bind(o,"feedback:click",function(){e.remove()})},T.prototype._showWait=function(){this._removeWait(),this._wait=new f,this.$el.appendChild(this._wait.$el),this._wait.center();var e=i.getScroll(window),t=i.getSize(window);this._wait.$el.css({top:e.y+(t.h-this._wait.$el.offsetHeight)/2+"px"})},T.prototype._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},T.prototype.remove=function(){this.$el.remove()},T.prototype.add=function(e){e=e||window;var s=e.document.body,n=e.document.documentElement,o=Math.max(s.scrollHeight,s.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight),a="acsModalContainer--"+this.instcfg.template;this.$el=r('<div class="'+a+'"></div>'),this.$el.css({height:o});var c=(this.$el,this.sv.cfg),h=this,d=r('<div class="acsModalBackFace"></div>'),l=r('<div class="acsModalChrome"></div>');if(this.browser.isIE&&8==this.browser.browser.version&&d.addClass("acsIE8"),!this.cfg.preview){i.Bind(d,"feedback:click",i.proxy(function(e){(this.survey||this.sv.networkError.didFire)&&(u("feedback_abandoned",{mid:c.mid}),this.survey?this.hide():this.remove())},this));var p=function(e){27==e.keyCode&&(u("feedback_abandoned",{mid:c.mid}),h.hide()),i.Unbind(document.body,"feedback:keyup",p)};i.Bind(document.body,"feedback:keyup",p),i.Bind(l,"feedback:click",function(e){var t=e.target;t&&t==l&&(u("feedback_abandoned",{mid:c.mid}),h.hide())})}var f=this.head=r('<div class="acsModalContent"></div>'),v=r('<div class="acsModalHead"></div>'),m=r('<img src="'+t.makeURI("/feedback/templates/"+(this.instcfg.template||"default")+"/closeBtn"+(this.IE8?"IE8":"")+".png")+'" class="acsModalCloseButton">');this.$head=v,v.appendChild(m),f.appendChild(v),this.$content=r('<div class="acsModalInnerContent"></div>'),f.appendChild(this.$content),l.appendChild(f),this.$el.appendChild(d),this.$el.appendChild(l);var b=e.document.body;b.appendChild(this.$el),this.cfg.preview||i.Bind(m,"feedback:click",function(e){u("feedback_abandoned",{mid:c.mid}),h.hide()}),setTimeout(function(){d.addClass("_acsActive")},20),this._showWait()},T.prototype.renderSurvey=function(){u("survey_shown",{mid:this.sv.cfg.mid}),this._removeWait(),this.$head.addClass("acsVisible"),this.survey.ansLogoSrc=t.makeURI("/feedback/p_b_answers.png");var e=h(this.modaltemplate,this.survey);this.$content.innerHTML=e,this.sv.bind(this.$content),this.positionModal(),this.$content.addClass("acsVisible"),this.sv.SurveyUIUpdated.fire()},T.prototype.positionModal=function(){var e=i.getScroll(window),t=i.getSize(window),s=this.$content.offsetHeight,n=Math.max(0,e.y+(t.h-s-50)/2)+"px";"undefined"!=typeof ACS_OVERRIDES&&ACS_OVERRIDES.FBALTSCROLL?this.head.style.top=n:this.head.style.marginTop=n},T.prototype.hide=function(){this.$el.css({display:"none"})},T.prototype.show=function(){this.$el.css({display:"block"})};var I=function(e,t,s){this.cfg=e,this.data=null,this.cpps=t,this.browser=s,this.validationPassed=!1,this.SurveyUIUpdated=new i.FSEvent,this.SurveySubmitStarted=new i.FSEvent,this.SurveySubmitted=new i.FSEvent,this.networkError=new i.FSEvent,this.fc=new i.FrameController("acsfeedback","feedback")};I.prototype._transpileJSONDef=function(e){function t(e,t){for(var i=0;i<t.length;i++){var s=t[i];e[s]&&(e[s]=e[s].replace(l,"<").replace(u,">"))}}var i,s,n,o,r={meta:e.survey.content.meta.info,ext:e.survey.content.meta["ext-info"],notopic:[],topics:[]},a=e.survey.content.main,c=a.cq,h=a.ca,d=a.ncq,l=/&lt;/gi,u=/&gt;/gi,p={};if(d&&"string"!=typeof d||(d={qstn:[]}),d.qstn&&"undefined"==typeof d.qstn.length&&(d.qstn=[d.qstn]),!this.cfg.autowhitelist&&this.cfg.topics.length>0)for(var f=0;f<this.cfg.topics.length;f++){var v=this.cfg.topics[f];m(v)&&(p[v.answerId]=!0)}for(t(r.meta,["epiloguetext","prologuetext"]),i=0;i<c.qstn.length;i++)for(n=c.qstn[i],t(n,["txt","lbl"]),r.notopic.push(n),n.answers=[],s=0;s<h.ans.length;s++)o=h.ans[s],o.qid==n.id&&(r.topics.push(o),n.answers.push(o));for(i=0;i<d.qstn.length;i++)for(n=d.qstn[i],t(n,["txt","lbl"]),n.answers=[],s=0;s<h.ans.length;s++)o=h.ans[s],o.qid==n.id&&n.answers.push(o);if(!this.cfg.autowhitelist&&this.cfg.topics.length>0){for(s=0;s<r.topics.length;s++)p[r.topics[s].id]||r.topics.splice(s--,1);for(s=0;s<r.notopic.length;s++)if("2"==r.notopic[s].qt)for(i=0;i<r.notopic[s].answers.length;i++)p[r.notopic[s].answers[i].id]||r.notopic[s].answers.splice(i--,1)}for(i=0;i<r.topics.length;i++){var b=r.topics[i];if(b.questions=[],d.qstn)for(s=0;s<d.qstn.length;s++)d.qstn[s].aid==b.id&&(t(d.qstn[s],["txt","lbl"]),b.questions.push(d.qstn[s]))}var g=[];for(i=0;i<r.notopic.length;i++)"2"==r.notopic[i].qt&&(g=r.notopic[i].answers);return r.vistopics=g,r},I.prototype._getSurveyData=function(e){var t=this;this.fc.ready.subscribe(function(){var s={mid:t.cfg.mid,cachebust:(new Date).getTime()};t.cfg.version&&(s.version=t.cfg.version),t._surveyReqTimer=setTimeout(i.proxy(function(){this.networkError.fire({type:"timedout"})},t),1e4),t.fc.ajax("GET",t.cfg.datauri,s,function(i,s){if(!t.networkError.didFire)if(i){clearTimeout(t._surveyReqTimer),t.data=t._transpileJSONDef(JSON.parse(s));var n=t.data.meta,o=!!n.logo2graphic,r=!!n.logo1graphic,a=!1,c=!1,h=function(){e&&e(t.data)};o||r?(o&&g(n.logo2graphic,function(e,t){a=!0,(!r||r&&c)&&h()}),r&&g(n.logo1graphic,function(e,t){c=!0,(!o||o&&a)&&h()})):h()}else t.networkError.fire({type:"getdata_failed"})})},!0,!0)},I.prototype._postSurveyData=function(e){var t=this;return this.cfg.preview?void setTimeout(function(){e&&e()},100):void this.fc.ajax("POST",this.cfg.posturi,this._serialize(),function(i,s){i?e&&e():(sessionStorage.setItem("acsFeedbackSubmitted","true"),e&&e(),t.networkError.fire({type:"postdata_failed"}))},!0,"application/json")},I.prototype._bindStars=function(e){e=r(e);for(var t=e.$("fieldset.star-rating"),s=this,n=function(e){return function(){for(var t=0;t<e.length;t++)r(e[t]).removeClass("_acsHover")}},o=function(e,t){return function(e){for(var i=!1,s=e.srcElement||e.explicitOriginalTarget,n=0;n<t.length;n++)i?r(t[n]).removeClass("_acsHover"):i||r(t[n]).addClass("_acsHover"),t[n]==s&&(i=!0)}},a=function(e,t,i){return function(n){i&&(s.validationPassed=!0);for(var o=!1,a=function(){e.removeClass("_acsRatingSet")},c=n.srcElement||n.originalTarget,h=0;h<t.length;h++)o?r(t[h]).removeClass("star-rating__star--fill"):o||r(t[h]).addClass("star-rating__star--fill"),t[h]==c&&(o=!0,c.checked=!0),e.addClass("_acsRatingSet"),setTimeout(a,250)}},c=0;c<t.length;c++){var h=r(t[c]),d=h.$("label"),l=h.$("input");i.Bind(h,"feedback:mouseleave",n(d));for(var u=0;u<d.length;u++)i.Bind(d[u],"feedback:mouseenter",o(h,d));for(var p=0;p<l.length;p++)i.Bind(l[p],"feedback:click",a(h,l,0===c))}},I.prototype._bindCBs=function(e){e=r(e);for(var t=e.$(".acs-feedback__cbox"),s=function(e){return function(t){for(var i=e.$("label"),s=0;s<i.length;s++){var n=r(i[s]),o=n.$("input[type=checkbox]")[0];o.checked?n.addClass("acsChecked"):n.removeClass("acsChecked")}}},n=0;n<t.length;n++)for(var o=r(t[n]),a=o.$("input[type=checkbox]"),c=0;c<a.length;c++)i.Bind(a[c],"feedback:change",s(o))},I.prototype._bindRadios=function(e){e=r(e);for(var t=e.$(".acs-feedback__radio"),s=function(e){return function(t){for(var i=e.$("label"),s=0;s<i.length;s++){var n=r(i[s]),o=n.$("input[type=radio]")[0];o.checked?n.addClass("acsChecked"):n.removeClass("acsChecked")}}},n=0;n<t.length;n++)for(var o=r(t[n]),a=o.$("input[type=radio]"),c=0;c<a.length;c++)i.Bind(a[c],"feedback:change",s(o))},I.prototype._bindSelects=function(e){e=r(e);for(var t=e.$(".acs-feedback__select"),s=this,n=function(e,t){return function(i){var s=r(t).$("option")[t.selectedIndex];e.innerHTML=s.innerHTML,i.stopPropagation()}},o=function(){s._updateSelects(e)},a=0;a<t.length;a++){var c=r(t[a]),h=c.$("select")[0],d=c.$("div.acs-feedback__select-button")[0];r(h).css({height:c.offsetHeight+"px"}),i.Bind(h,"feedback:change",n(d,h))}this.SurveyUIUpdated.subscribe(function(){setTimeout(o,100)})},I.prototype._updateSelects=function(e){e=r(e);for(var t=e.$(".acs-feedback__select"),i=0;i<t.length;i++){var s=r(t[i]),n=s.$("select")[0];s.$("div.acs-feedback__select-button")[0];s.offsetHeight>0&&r(n).css({height:(s.offsetHeight||38)+"px"})}},I.prototype._bindTextAreas=function(e){e=r(e);for(var t=e.$(".acs-feedback__textarea"),s=function(e){var t=e.target||e.srcElement,i=parseInt(t.getAttribute("acsmaxlength"),10),s=t.value.replace(/\s+/g," ").length,n=i-s,o=r(t.parentNode),a=o.$(".acs-feedback__textarea--count")[0];return a.innerHTML=Math.max(0,n),0>n?(t.value=t.value.substr(0,t.value.length+n),!1):void 0},n=function(e){var t=e.target||e.srcElement,i=parseInt(t.getAttribute("acsmaxlength"),10),s=t.value.replace(/\s+/g," ").length,n=i-s-1,o=e.keyCode;
return 0>n&&8!=o&&16!=o&&!(o>=37&&41>=o)?(e.preventDefault(),!1):void 0},o=0;o<t.length;o++){var a=r(t[o]),c=a.$("textarea")[0];a.$(".acs-feedback__textarea--count")[0];/^[0-9]+$/.test(c.getAttribute("acsmaxlength"))&&(i.Bind(c,"feedback:keydown",n),i.Bind(c,"feedback:keyup",s),i.Bind(c,"feedback:blur",s))}},I.prototype._serialize=function(){var e={mid:this.cfg.mid,url:window.location.toString().indexOf("&acsUrl")>-1?i.getParam("acsUrl"):window.location.toString(),responses:[]},t=e.responses,s=this.$el.$(".acs-visible__topic .acs-feedback__block, .acs-feedback__block.acs-persistent__block"),n=function(e){var t={electron:/(4026|417500|4405|4508|4844|4913|4917)[0-9]{11,12}/g,maestro:/(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)[0-9]{12}/g,dankort:/(5019)[0-9]{12}/g,instaPayment:/(637|638|639)[0-9]{13}/g,visa:/4[0-9]{12}(?:[0-9]{3})?/g,mastercard:/5[1-5][0-9]{14}/g,amex:/3[47][0-9]{13}/g,diners:/3(?:0[0-5]|[68][0-9])[0-9]{11}/g,discover:/6(?:011|5[0-9]{2}|22[19]|4[56789][0-9]{1})[0-9]{12}/g,jcb:/(?:2131|1800|35\d{3})\d{11}/g},i=e;for(var s in t)if(t[s].test(e)){var n=e.match(t[s]),o=new Array(n[0].length+1).join("X");i=i.replace(t[s],o)}return i};if(1==this.data.vistopics.length)for(var o=0;o<this.data.notopic.length;o++){var a=this.data.notopic[o];if("2"==a.qt){t.push({questionId:a.id,answerId:a.answers[0].id});break}}for(var c=0;c<s.length;c++){var h=s[c].getAttribute("questionid"),d=s[c].getAttribute("data-question-type");if(h)if("5"==d)for(var l=r(s[c]),u=l.$("input"),p=0;p<u.length;p++){var f=u[p].getAttribute("questionid");u[p].checked&&t.push({questionId:h,answerId:f})}else{var v={questionId:h},m=r(s[c]),b=m.$("input"),g=m.$("textarea"),y=m.$("select");if(b.length>0){var w=b[0].getAttribute("type");if("radio"==w){for(var _=0;_<b.length;_++)if(b[_].checked){v.answerId=b[_].value;var k=b[_].getAttribute("label");k&&(v.answerText=decodeURIComponent(k))}}else"hidden"==w?v.answerId=b[0].value:v.answerText=b[0].value}else if(g.length>0){var $=g[0].value.replace(/\s+/g," ");if($.length>13){var S=/(\d)[\s\-\.\\\/]+(?=\d)/g,C=n($.replace(S,"$1"));$=C}$.length>=1e3&&($=$.substr(0,999)),v.answerText=$}else if(y.length>0&&y[0].selectedIndex>0&&(v.answerId=y[0].value,!v.answerId||0===v.answerId.length))continue;t.push(v)}}var x=this.cpps.all();for(var T in x)t.push({questionId:T,answerText:x[T]});return this.cfg.replay===!0&&E&&(e.globalId=E.recorder.getGlobalId(),e.sessionId=""),this.cfg.version&&(e.version=this.cfg.version),e=JSON.stringify(e)},I.prototype._validationStatus=function(e){var t=r(this.$el.$(".acs-validation-block")[0]);e?t.css({display:"block"}):t.css({display:"none"})},I.prototype.bind=function(e){function t(t){for(var i=e.$(".acs-feedback__topic"),n=0;n<i.length;n++)r(i[n]).removeClass("acs-visible__topic");try{r(document.getElementById("topk_"+t)).addClass("acs-visible__topic"),s._topic=t}catch(o){}s.SurveyUIUpdated.fire()}var s=this;s.submitted=!1,s._bindSelects(e),s._bindStars(e),s._bindTextAreas(e),s._bindCBs(e),s._bindRadios(e),e=r(e),s.$el=e;for(var n=e.$(".acs-headingzone h1"),o=0;o<n.length;o++)r(n[o]).addClass("acs-feedback__heading acs-feedback__heading--h1");i.Bind(e.$(".acs-submit-feedback__button")[0],"click",function(e){return s._validationStatus(!s.validationPassed),s.validationPassed&&!s.submitted&&(s.SurveySubmitStarted.fire(),s.submitted=!0,s._postSurveyData(function(){s.SurveySubmitted.fire()})),e&&e.preventDefault&&e.preventDefault(),!1});var a=e.$(".acs-topic__selector")[0];i.Bind(a,"feedback:change",function(e){return function(i){t(e.value)}}(a)),1==this.data.vistopics.length&&(r(document.getElementById("topk_"+this.data.vistopics[0].id)).addClass("acs-visible__topic"),this._updateSelects(e))};var E=null,B=null,q={setup:function(s,n,o,r){e([t.makeURI("cxreplay/fs.record.js"),"recordconfig"],function(e,t){n.set("cxreplayaws","true"),B||(B=new i.ACSStorage),E=e.getInstance(s,window,B),r(E)})},startTransmitting:function(e,t,i){i.replay===!0&&(E?E.beginTransmitting():q.setup(e,t,i,function(e){e.setTransmitOK()}))}},R=function(e,t,s){this.height=600,this.width=400,this.survey=e,this.cfg=t,this.cpps=e.cpps,this.SurveySubmitted=new i.FSEvent,this.br=s};R.prototype.show=function(){if(!this.winRef){var e=JSON.stringify(this.cpps.all()),i=t.makeURI("/feedback/fs.feedbacksurvey.html?mid="+encodeURIComponent(this.survey.cfg.mid)+"&t="+encodeURIComponent(this.cfg.template||"default")+"&acsUrl="+encodeURIComponent(window.location.href)+"&cpps="+encodeURIComponent(e)+"&ns="+encodeURIComponent(this.cpps.site_id())),s=this;this.br.isIE&&this.br.browser.actualVersion<=11&&("//"==i.substr(0,2)&&(i="https:"+i),"http"==i.substr(0,4)&&i.replace("http","https")),this.winRef=window.open(i,"_system"),this._checker=setInterval(function(){try{var e=s.winRef.location+"";e.indexOf("acsSurveyComplete")>-1&&(clearInterval(s._checker),s.SurveySubmitted.fire())}catch(t){clearInterval(s._checker),s.SurveySubmitted.fire()}},500)}};var M=function(e,t,s,n,o,r){this.cfg=e,this.br=t,this.cpps=s,this.errortemplate=n,this.modaltemplate=o,this.eptemplate=r,this.init(),this.SurveySubmitted=new i.FSEvent,this.NetworkError=new i.FSEvent};M.prototype.init=function(){var e=this,t=i.getSize(window);switch("fullpage"!==this.cfg.surveytype&&(this.br.isMobile||t.w<=500)&&(this.cfg.surveytype="popup"),this.cfg.surveytype){case"popup":this.chrome=new R(new I(this.cfg,this.cpps,this.br),this.cfg,this.br),this.chrome.SurveySubmitted.subscribe(function(){e.SurveySubmitted.fire()}),this.chrome.show();break;case"modal":i.isDefined(this.chrome)?this.chrome.show():(this.survey=new I(this.cfg,this.cpps,this.br),this.chrome=new T(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){e.SurveySubmitted.fire()}),this.survey.networkError.subscribe(function(){e.NetworkError.fire()}));break;case"fullpage":i.isDefined(this.chrome)?this.chrome.show():(this.survey=new I(this.cfg,this.cpps,this.br),this.chrome=new S(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){e.SurveySubmitted.fire()}),this.survey.networkError.subscribe(function(){e.NetworkError.fire()}))}},M.prototype.show=function(){this.chrome.show()},M.prototype.hide=function(){this.chrome&&this.chrome.hide()},config=i.ext({browser_cutoff:{IE:8,IEMobile:8,Safari:4,Firefox:11,Chrome:20,Opera:1e3},platform_cutoff:{Android:4,Winphone:7.4,iPod:7,iPhone:7,iPad:7}},config),t.domReady(function(){var e=!!y("previewmode"),s=!!y("previewbadgemode"),n=config.instances,o=[],r=[],a=!1;if(TemplateReady=new i.FSEvent,n||e||s){var c=new i.Browser;c.browserReady.subscribe(function(){if(e){var h=new $(c);return void h.show()}if("IE"==c.browser.name&&c.browser.version<9)for(var d=0;d<n.length;d++)"vertical"==n[d].fbdirection&&(n[d].fbdirection="horizontal");var u=new w(c,config),f=new i.CPPS(null,"feedback");if(f.set("code_version",config.code_version),f.set("env",t.isProduction?"prd":"stg"),s){var v=JSON.parse(decodeURIComponent(i.getParam("cfg")));return void(v.mid&&(prevBadge=new C(v,c,f),prevBadge.renderBadge()))}if(u.platformOK()){p.exposePublicAPI(window,f,c);for(var b=0;b<n.length;b++){for(var g=n[b],y=!1,k=0;k<g.topics.length;k++)if(m(g.topics[k])){y=!0;break}if(n[b].replay===!0&&(a=!0),(y||0===g.topics.length)&&!g.disabled&&window==window.top){var S=!1;g.template||(g.template="default");for(var T=0;T<r.length;T++)r[T]===g.template&&(S=!0);S||r.push(g.template),o.push(g)}}if(o.length>0){var I=r.length>0?r:["default"],E=new _(c,f,I);E.loadSuccess.subscribe(i.proxy(function(e){for(var t=0;t<o.length;t++)if("badge"===o[t].fbtype){var i=e[o[t].template];o[t].badge=new l(o[t],c,f,i.typeTemplate,i.emTemplate,!0),o[t].badge.setBtnTemplate(),o[t].badge.surveyTriggered.subscribe(function(e){return function(){e.replay===!0&&q.startTransmitting(c,f,e),x.initialize(e,c,f,i.emTemplate,i.svContentsTemplate,i.epTemplate)}}(o[t]),!1,!1)}x.SurveySubmitted.subscribe(function(e){if(e&&e.mid)for(var t=0;t<o.length;t++)o[t].badge&&o[t].mid===e.mid&&o[t].badge.remove();else for(var i=0;i<o.length;i++)o[i].badge&&o[i].badge.remove()})},this),!0,!0)}a&&q.setup(c,f,o[0],function(e){for(var t=0;t<o.length;t++)o[t].stg=B,o[t].record=e})}},!0,!0)}})}});